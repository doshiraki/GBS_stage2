<script>
/**
 * ğŸ¨ AnalogClockRenderer Library
 * Canvasæ“ä½œã¨ä¸‰è§’é–¢æ•°è¨ˆç®—ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ãŸã‚¯ãƒ©ã‚¹
 */
class AnalogClockRenderer {
  constructor(canvas, options = {}) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d');
    this.radius = canvas.height / 2;
    // åŸç‚¹ã‚’Canvasã®ä¸­å¿ƒã«ç§»å‹•
    this.ctx.translate(this.radius, this.radius);
    this.radius = this.radius * 0.90;
    
    this.options = {
      faceColor: options.faceColor || '#fff',
      handColor: options.handColor || '#333',
      secondHandColor: options.secondHandColor || 'red'
    };
  }

  // ãƒ¡ã‚¤ãƒ³æç”»ãƒ¡ã‚½ãƒƒãƒ‰
  draw(date) {
    this.clear();
    this.drawFace();
    this.drawTime(date);
  }

  clear() {
    // åº§æ¨™ç³»ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚¯ãƒªã‚¢ã—ã€å†åº¦ä¸­å¿ƒã¸ç§»å‹•
    this.ctx.setTransform(1, 0, 0, 1, 0, 0);
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    this.ctx.translate(this.canvas.width/2, this.canvas.height/2);
  }

  drawFace() {
    const ctx = this.ctx;
    const radius = this.radius;

    // å¤–æ 
    ctx.beginPath();
    ctx.arc(0, 0, radius, 0, 2 * Math.PI);
    ctx.strokeStyle = this.options.faceColor;
    ctx.lineWidth = radius * 0.05;
    ctx.stroke();

    // ç›®ç››ã‚Š
    ctx.fillStyle = this.options.faceColor;
    for(let num = 1; num <= 12; num++){
      const ang = num * Math.PI / 6;
      ctx.rotate(ang);
      ctx.translate(0, -radius * 0.85);
      
      // 12, 3, 6, 9 ã¯å°‘ã—å¤§ãã
      if (num % 3 === 0) {
        ctx.fillRect(-2, -10, 4, 15);
      } else {
        ctx.fillRect(-1, -5, 2, 10);
      }
      
      ctx.translate(0, radius * 0.85);
      ctx.rotate(-ang);
    }
  }

  drawTime(date) {
    const ctx = this.ctx;
    const radius = this.radius;
    let hour = date.getHours();
    let minute = date.getMinutes();
    let second = date.getSeconds();
    let ms = date.getMilliseconds();

    // ç§’é‡ï¼ˆæ»‘ã‚‰ã‹ã«å‹•ãã‚ˆã†ã«ãƒŸãƒªç§’ã‚‚è€ƒæ…®ï¼‰
    second = second + (ms / 1000);
    
    // æ™‚é‡
    hour = hour % 12;
    hour = (hour * Math.PI / 6) + (minute * Math.PI / (6 * 60)) + (second * Math.PI / (360 * 60));
    this.drawHand(ctx, hour, radius * 0.5, radius * 0.07, this.options.handColor);

    // åˆ†é‡
    minute = (minute * Math.PI / 30) + (second * Math.PI / (30 * 60));
    this.drawHand(ctx, minute, radius * 0.8, radius * 0.05, this.options.handColor);

    // ç§’é‡
    const secondAngle = (second * Math.PI / 30);
    this.drawHand(ctx, secondAngle, radius * 0.9, radius * 0.02, this.options.secondHandColor);
    
    // ä¸­å¿ƒç‚¹
    ctx.beginPath();
    ctx.arc(0, 0, radius * 0.05, 0, 2 * Math.PI);
    ctx.fillStyle = this.options.secondHandColor;
    ctx.fill();
  }

  drawHand(ctx, pos, length, width, color) {
    ctx.beginPath();
    ctx.lineWidth = width;
    ctx.lineCap = "round";
    ctx.strokeStyle = color;
    ctx.moveTo(0, 0);
    ctx.rotate(pos);
    ctx.lineTo(0, -length);
    ctx.stroke();
    ctx.rotate(-pos);
  }
}
</script>
